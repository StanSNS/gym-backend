name: Azure App Service - gymfitbulgaria-api(Production), Build and deploy Spring app

on:
  push:
    branches:
      - main

jobs:
  terraform-destroy:
    runs-on: ubuntu-latest

    steps:
      # Checkout the different repository with the main.tf file
      - name: 'Checkout Terraform Repo'
        uses: actions/checkout@v2
        with:
          repository: StanSNS/Gym-infra
          path: terraform

#      # Set up Azure CLI
#      - name: 'Login to Azure'
#        uses: azure/login@v1
#        with:
#          creds: ${{ secrets.AZURE_CREDENTIALS }}
#
#      # Set up Terraform
#      - name: Set up Terraform
#        uses: hashicorp/setup-terraform@v2
#        with:
#          terraform_version: 1.3.7
#
#      # Initialize Terraform
#      - name: Terraform Init
#        working-directory: terraform
#        run: terraform init
#
#      # Execute Terraform Destroy targeting specific resources
#      - name: Terraform Destroy Targeting Specific Resources
#        working-directory: terraform
#        run: terraform destroy -auto-approve -target=azurerm_resource_group.rgbs
#
#      # Configure Git
#      - name: Set up Git
#        run: |
#          git config --global user.name "github-actions[bot]"
#          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"

      # Commit and push updated terraform.tfstate
      - name: Commit and Push State File
        working-directory: terraform
        run: |
          echo "Test push commit to the remote in the workflow" >> test.txt
#          git add terraform.tfstate
#          git commit -m "Update terraform.tfstate after destroy"
#          git push
          git add test.txt
          git commit -m "Update test.txt"
          git push

        env:
          github_token: ${{ secrets.AUTH_TOKEN }}

#  build-and-deploy:
#    runs-on: windows-latest
#    needs: terraform-destroy
#
#    steps:
#    # checkout the repo
#    - name: 'Checkout Github Action'
#      uses: actions/checkout@master
#
#
#    - name: Set up Java version
#      uses: actions/setup-java@v1
#      with:
#        java-version: '17'
#
#    - name: Build with Maven
#      run: mvn clean install
#
#    - name: Run Azure webapp deploy action using publish profile credentials
#      uses: azure/webapps-deploy@v2
#      with:
#        app-name: gymfitbulgaria-api
#        slot-name: Production
#        publish-profile: ${{ secrets.AZUREAPPSERVICE_PUBLISHPROFILE_0EC7C6B52D3F436B824D707339550EA5 }}
#        package: ${{ github.workspace }}/target/*.jar

